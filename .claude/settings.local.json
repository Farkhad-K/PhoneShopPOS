{
  "permissions": {
    "allow": [
      "Bash(wc:*)",
      "Bash(dir:*)",
      "Bash(\"C:\\\\Users\\\\Farxod\\\\dev\\\\comercial\\\\techNova\\\\phone-sell\\\\fullstack-template\\\\fullstack-template\\\\frontend\\\\frontend-plan.md\" << 'FRONTEND_PLAN_EOF'\n# Frontend Implementation Plan - Phone Shop POS\n\n## Overview\n\nBuild a React frontend for Phone Shop POS system using the existing Vite + ShadcnUI boilerplate. We will create intuitive, fast interfaces for daily shop operations \\(purchase, repair, sale, debt/credit management\\).\n\n**Architecture:** Redux Toolkit for state, RTK Query for API calls, React Hook Form + Zod for forms, ShadcnUI for components.\n\n---\n\n## Design Principles\n\n1. **Mobile-First:** Shop employees may use tablets or phones\n2. **Fast Workflows:** Minimize clicks for common operations\n3. **Clear Visual Hierarchy:** Critical info \\(price, balance\\) stands out\n4. **Error Prevention:** Validation before submission, confirmation dialogs\n5. **Offline-Ready \\(Future\\):** Queue operations when offline \\(Phase 2\\)\n\n---\n\n## UI Structure\n\n```\nApp\n├── Layout \\(Sidebar + Header\\)\n│   ├── Dashboard \\(Overview metrics\\)\n│   ├── Inventory\n│   │   ├── All Phones \\(list/grid view\\)\n│   │   └── Phone Detail \\(view/edit\\)\n│   ├── Transactions\n│   │   ├── Purchases \\(list + create\\)\n│   │   ├── Sales \\(list + create\\)\n│   │   └── Repairs \\(list + create\\)\n│   ├── Customers\n│   │   ├── Customer List \\(search\\)\n│   │   └── Customer Profile \\(debt/credit, history\\)\n│   ├── Payments\n│   │   ├── Collect Debt\n│   │   └── Pay Credit\n│   ├── Reports \\(MANAGER+\\)\n│   │   ├── Sales Report\n│   │   ├── Purchases Report\n│   │   ├── Repair Report\n│   │   └── Profit Report\n│   ├── Workers \\(OWNER only\\)\n│   │   ├── Worker List\n│   │   └── Monthly Payments\n│   └── Settings\n│       ├── Account\n│       └── Shop Configuration\n└── Auth\n    ├── Sign In\n    └── Forgot Password\n```\n\n---\n\n## Implementation Milestones\n\n### Milestone 1: API Integration Setup\n**Goal:** Connect frontend to backend APIs\n\n**Tasks:**\n1. Update API path constants in `src/api/path.ts`\n2. Create RTK Query endpoints for each entity\n3. Update Redux auth slice to handle 4 roles\n4. Update `ProtectedRoute` with role hierarchy\n5. Test token refresh flow\n\n**Files to Modify:**\n- `src/api/path.ts` - Add all entity paths\n- `src/api/phones/index.ts` \\(NEW\\) - Phone endpoints\n- `src/api/purchases/index.ts` \\(NEW\\) - Purchase endpoints\n- `src/api/sales/index.ts` \\(NEW\\) - Sale endpoints\n- `src/api/customers/index.ts` \\(NEW\\) - Customer endpoints\n- `src/api/payments/index.ts` \\(NEW\\) - Payment endpoints\n- `src/api/repairs/index.ts` \\(NEW\\) - Repair endpoints\n- `src/api/reports/index.ts` \\(NEW\\) - Report endpoints\n- `src/api/workers/index.ts` \\(NEW\\) - Worker endpoints\n- `src/store/slices/authSlice.ts` - Update role types\n- `src/components/router/protected-route.tsx` - Role hierarchy logic\n\n**API Endpoints to Create:**\n\n```typescript\n// src/api/phones/index.ts\nexport const phonesApi = baseApi.injectEndpoints\\({\n  endpoints: \\(builder\\) => \\({\n    getPhones: builder.query<PaginatedResponse<Phone>, PaginationQueryDto>\\({\n      query: \\(params\\) => \\({\n        url: API_PATHS.PHONES.BASE,\n        params,\n      }\\),\n      providesTags: ['PHONES'],\n    }\\),\n    getPhoneByBarcode: builder.query<Phone, string>\\({\n      query: \\(barcode\\) => API_PATHS.PHONES.BY_BARCODE\\(barcode\\),\n      providesTags: \\(result, error, barcode\\) => [{ type: 'PHONES', id: barcode }],\n    }\\),\n    updatePhone: builder.mutation<Phone, { id: number; data: UpdatePhoneDto }>\\({\n      query: \\({ id, data }\\) => \\({\n        url: API_PATHS.PHONES.BY_ID\\(id\\),\n        method: 'PATCH',\n        body: data,\n      }\\),\n      invalidatesTags: ['PHONES'],\n    }\\),\n  }\\),\n}\\);\n\n// Export hooks\nexport const {\n  useGetPhonesQuery,\n  useGetPhoneByBarcodeQuery,\n  useUpdatePhoneMutation,\n} = phonesApi;\n```\n\n**Acceptance:**\n- All API endpoints callable from frontend\n- Token refresh on 401 works\n- Role-based route protection functional\n\n---\n\n### Milestone 2: Dashboard \\(Overview\\)\n**Goal:** Show key metrics and recent activity\n\n**Components:**\n- `src/app/dashboard/overview.tsx`\n- `src/components/features/dashboard/MetricCard.tsx`\n- `src/components/features/dashboard/RecentSales.tsx`\n- `src/components/features/dashboard/InventoryStatus.tsx`\n\n**Layout:**\n```\n┌─────────────────────────────────────────────┐\n│  Metric Cards \\(4 columns\\)                   │\n│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐       │\n│  │ Total│ │Today │ │Stock │ │Profit│       │\n│  │Sales │ │Sales │ │Count │ │MTD   │       │\n│  └──────┘ └──────┘ └──────┘ └──────┘       │\n├─────────────────────────────────────────────┤\n│  Charts \\(2 columns\\)                         │\n│  ┌────────────────┐ ┌────────────────┐     │\n│  │ Sales Trend    │ │ Top Phones     │     │\n│  │ \\(Line Chart\\)   │ │ \\(Bar Chart\\)    │     │\n│  └────────────────┘ └────────────────┘     │\n├─────────────────────────────────────────────┤\n│  Recent Activity \\(Table\\)                    │\n│  ┌───────────────────────────────────────┐ │\n│  │ Time | Type | Item | Amount | Status │ │\n│  └───────────────────────────────────────┘ │\n└─────────────────────────────────────────────┘\n```\n\n**API Calls:**\n- `GET /api/reports/sales?dateFrom=today` - Today's sales\n- `GET /api/phones?status=IN_STOCK&status=READY_FOR_SALE` - Stock count\n- `GET /api/reports/profit?dateFrom=monthStart` - MTD profit\n- `GET /api/sales?limit=5&sort=saleDate:DESC` - Recent sales\n\n**Acceptance:**\n- Dashboard loads in < 2s\n- Metrics update on refresh\n- Charts display correctly\n- Role-based: CASHIER+ can view\n\n---\n\n### Milestone 3: Customer Management\n**Goal:** Create/search/view customers with balances\n\n**Pages:**\n- `src/app/customers/list.tsx` - Customer list with search\n- `src/app/customers/[id]/profile.tsx` - Customer detail page\n\n**Components:**\n- `src/components/features/customers/CustomerSearchInput.tsx` - Phone number search\n- `src/components/features/customers/CustomerForm.tsx` - Create/edit form\n- `src/components/features/customers/BalanceSummary.tsx` - Debt/credit display\n- `src/components/features/customers/TransactionHistory.tsx` - Purchase/sale/payment list\n\n**Customer List Features:**\n- Search by phone number \\(auto-search on type, debounced\\)\n- Filter: All / With Debt / With Credit\n- Sort: Name, Debt, Credit\n- Quick actions: View, Edit, Add Payment\n\n**Customer Profile Layout:**\n```\n┌─────────────────────────────────────────────┐\n│  Customer Info                              │\n│  Name: John Doe    Phone: +998901234567    │\n│  ┌──────────┐ ┌──────────┐                 │\n│  │ DEBT     │ │ CREDIT   │                 │\n│  │ $500     │ │ $200     │                 │\n│  └──────────┘ └──────────┘                 │\n│  [Collect Debt] [Pay Credit]               │\n├─────────────────────────────────────────────┤\n│  Transaction History \\(Tabs\\)                │\n│  [Sales] [Purchases] [Payments]            │\n│  ┌───────────────────────────────────────┐ │\n│  │ Date | Type | Amount | Balance       │ │\n│  └───────────────────────────────────────┘ │\n└─────────────────────────────────────────────┘\n```\n\n**Forms:**\n- **Create Customer Form:**\n  - Full Name \\(required\\)\n  - Phone Number \\(required, validated\\)\n  - Address \\(optional\\)\n  - Passport ID \\(optional\\)\n  - Notes \\(optional\\)\n- Validation: Zod schema\n- Duplicate check: warn if phone number exists\n\n**Acceptance:**\n- Can create customer in < 10s\n- Phone search returns results instantly \\(< 300ms\\)\n- Balance display is accurate\n- Transaction history paginated\n\n---\n\n### Milestone 4: Purchase Flow\n**Goal:** Buy phones from customers\n\n**Pages:**\n- `src/app/purchases/list.tsx` - Purchase history\n- `src/app/purchases/create.tsx` - New purchase form\n\n**Components:**\n- `src/components/features/purchases/PurchaseForm.tsx`\n- `src/components/features/purchases/PhoneInputRow.tsx` - Add multiple phones\n- `src/components/features/purchases/CustomerSelector.tsx` - Search + select customer\n- `src/components/features/purchases/PaymentCalculator.tsx` - Paid/remaining calculation\n\n**Purchase Form Flow:**\n```\nStep 1: Customer Info \\(if pay-later\\)\n┌─────────────────────────────────────────┐\n│ Payment Type: ⚫ Paid Now  ⚪ Pay Later │\n│ [Customer Search] \\(if pay later\\)       │\n└─────────────────────────────────────────┘\n\nStep 2: Phone Details \\(repeatable\\)\n┌─────────────────────────────────────────┐\n│ Phone #1                                │\n│ Brand: [Apple ▼]  Model: [___________] │\n│ Storage: [128GB ▼]  Color: [_________] │\n│ IMEI: [___________________________]    │\n│ Condition: ⚫ Good ⚪ Used ⚪ Broken    │\n│ Issues: [_____________________________]│\n│ Purchase Price: [$__________]          │\n│ [+ Add Another Phone]                  │\n└─────────────────────────────────────────┘\n\nStep 3: Payment\n┌─────────────────────────────────────────┐\n│ Total Purchase Price: $500              │\n│ Payment Method: ⚫ Cash ⚪ Card         │\n│ Paid Amount: [$__________]             │\n│ Remaining \\(Credit\\): $100 \\(auto-calc\\)   │\n│ Notes: [_____________________________] │\n│                                         │\n│ [Cancel]              [Create Purchase]│\n└─────────────────────────────────────────┘\n```\n\n**Validation:**\n- If pay-later: customer required\n- Paid amount <= total price\n- IMEI format validation \\(15 digits\\)\n- At least one phone required\n\n**Success Flow:**\n1. Show success toast with barcode\\(s\\)\n2. Offer to print barcode labels\n3. Redirect to inventory or create another\n\n**Acceptance:**\n- Can create purchase with 1 phone in < 30s\n- Can add multiple phones easily\n- Barcode generation works\n- Pay-later creates customer credit\n- Form remembers brand/model for next phone \\(UX improvement\\)\n\n---\n\n## Shared Components to Build\n\n### 1. Barcode Scanner\n**File:** `src/components/features/barcode/BarcodeScanner.tsx`\n- Use device camera or USB barcode scanner\n- Library: `react-barcode-reader` or `quagga2`\n- Fallback: manual input\n\n### 2. Barcode Display\n**File:** `src/components/features/barcode/BarcodeDisplay.tsx`\n- Library: `react-barcode`\n- Show barcode image from code\n- Print button\n\n### 3. Receipt Printer\n**File:** `src/components/features/print/ReceiptPrinter.tsx`\n- Use `react-to-print` library\n- Templates: Sale Receipt, Payment Receipt\n- Show: shop name, date, items, amounts, balance\n\n### 4. Phone Number Input\n**File:** `src/components/features/forms/PhoneNumberInput.tsx`\n- Format: +998 \\(90\\) 123-45-67\n- Validation: Uzbekistan phone numbers\n- Auto-format on type\n\n### 5. Currency Input\n**File:** `src/components/features/forms/CurrencyInput.tsx`\n- Format: $1,234.56\n- Decimal precision: 2\n- Validation: positive numbers only\n\n### 6. Status Badge\n**File:** `src/components/features/common/StatusBadge.tsx`\n- Color-coded badges for statuses\n- Phone status: blue \\(IN_STOCK\\), yellow \\(IN_REPAIR\\), green \\(READY_FOR_SALE\\), gray \\(SOLD\\)\n- Payment status: green \\(PAID\\), red \\(UNPAID\\), orange \\(PARTIAL\\)\n\n---\n\n## Form Validation Schemas \\(Zod\\)\n\n### Customer Schema\n```typescript\n// src/schemas/customer.schema.ts\nexport const customerSchema = z.object\\({\n  fullName: z.string\\(\\).min\\(2, 'Name must be at least 2 characters'\\),\n  phoneNumber: z.string\\(\\).regex\\(/^\\\\+998\\\\d{9}$/, 'Invalid phone number'\\),\n  address: z.string\\(\\).optional\\(\\),\n  passportId: z.string\\(\\).optional\\(\\),\n  notes: z.string\\(\\).optional\\(\\),\n}\\);\n```\n\n### Purchase Schema\n```typescript\nexport const purchaseSchema = z.object\\({\n  paymentType: z.enum\\(['PAID_NOW', 'PAY_LATER']\\),\n  customerId: z.number\\(\\).optional\\(\\),\n  phones: z.array\\(z.object\\({\n    brand: z.string\\(\\).min\\(1, 'Brand is required'\\),\n    model: z.string\\(\\).min\\(1, 'Model is required'\\),\n    storage: z.string\\(\\).optional\\(\\),\n    color: z.string\\(\\).optional\\(\\),\n    imei: z.string\\(\\).regex\\(/^\\\\d{15}$/, 'IMEI must be 15 digits'\\).optional\\(\\),\n    conditionAtPurchase: z.enum\\(['Good', 'Used', 'Broken']\\),\n    knownIssues: z.string\\(\\).optional\\(\\),\n    purchasePrice: z.number\\(\\).min\\(0, 'Price must be positive'\\),\n  }\\)\\).min\\(1, 'At least one phone required'\\),\n  paymentMethod: z.enum\\(['Cash', 'Card', 'Other']\\),\n  paidAmount: z.number\\(\\).min\\(0\\),\n  notes: z.string\\(\\).optional\\(\\),\n}\\).refine\\(data => {\n  if \\(data.paymentType === 'PAY_LATER' && !data.customerId\\) {\n    return false;\n  }\n  return true;\n}, {\n  message: 'Customer is required for pay-later purchases',\n  path: ['customerId'],\n}\\);\n```\n\n---\n\n## State Management Structure\n\n### Redux Slices\n\n```typescript\n// src/store/slices/phonesSlice.ts\ninterface PhonesState {\n  selectedPhone: Phone | null;\n  filters: {\n    status: PhoneStatus[];\n    brand: string[];\n    priceRange: [number, number];\n  };\n}\n\n// src/store/slices/customersSlice.ts\ninterface CustomersState {\n  selectedCustomer: Customer | null;\n  searchQuery: string;\n}\n\n// \\(Keep auth slice as is, just update roles\\)\n```\n\n### RTK Query Tags\n```typescript\n// src/api/index.ts\ntagTypes: [\n  'AUTH',\n  'USERS',\n  'PHONES',\n  'PURCHASES',\n  'SALES',\n  'REPAIRS',\n  'CUSTOMERS',\n  'PAYMENTS',\n  'REPORTS',\n  'WORKERS',\n]\n```\n\n---\n\n## Performance Optimizations\n\n1. **Lazy Loading:**\n   - All pages loaded via React.lazy\\(\\)\n   - Chunk splitting for reports \\(heavy charts\\)\n\n2. **Virtualization:**\n   - Use `react-window` for large lists \\(>100 items\\)\n   - Virtualize inventory grid view\n\n3. **Debouncing:**\n   - Search inputs debounced \\(300ms\\)\n   - Auto-save drafts debounced \\(1000ms\\)\n\n4. **Caching:**\n   - RTK Query cache \\(5 minutes for reports\\)\n   - Invalidate tags on mutations\n\n5. **Memoization:**\n   - `useMemo` for expensive calculations \\(profit, totals\\)\n   - `React.memo` for card components\n\n---\n\n## Dependencies to Add\n\n```bash\n# Barcode\nnpm install react-barcode react-barcode-reader\n\n# Printing\nnpm install react-to-print\n\n# Date picker\nnpm install react-day-picker date-fns\n\n# Phone input\nnpm install react-phone-number-input\n\n# Charts \\(already installed: recharts\\)\n\n# Virtualization\nnpm install react-window\n\n# PDF export\nnpm install jspdf jspdf-autotable\n```\n\n---\n\n## Sidebar Navigation Structure\n\n```typescript\n// src/config/sidebar-nav.ts\nexport const sidebarNav = [\n  {\n    title: 'Dashboard',\n    icon: LayoutDashboard,\n    href: '/dashboard',\n    roles: ['CASHIER', 'MANAGER', 'OWNER'],\n  },\n  {\n    title: 'Inventory',\n    icon: Package,\n    href: '/inventory',\n    roles: ['CASHIER', 'MANAGER', 'OWNER'],\n  },\n  {\n    title: 'Transactions',\n    icon: Receipt,\n    items: [\n      { title: 'Purchases', href: '/purchases', roles: ['CASHIER', 'MANAGER', 'OWNER'] },\n      { title: 'Sales', href: '/sales', roles: ['CASHIER', 'MANAGER', 'OWNER'] },\n      { title: 'Repairs', href: '/repairs', roles: ['TECHNICIAN', 'MANAGER', 'OWNER'] },\n    ],\n  },\n  {\n    title: 'Customers',\n    icon: Users,\n    href: '/customers',\n    roles: ['CASHIER', 'MANAGER', 'OWNER'],\n  },\n  {\n    title: 'Payments',\n    icon: DollarSign,\n    items: [\n      { title: 'Collect Debt', href: '/payments/debt', roles: ['CASHIER', 'MANAGER', 'OWNER'] },\n      { title: 'Pay Credit', href: '/payments/credit', roles: ['MANAGER', 'OWNER'] },\n    ],\n  },\n  {\n    title: 'Reports',\n    icon: BarChart,\n    href: '/reports',\n    roles: ['MANAGER', 'OWNER'],\n  },\n  {\n    title: 'Workers',\n    icon: Briefcase,\n    href: '/workers',\n    roles: ['OWNER'],\n  },\n  {\n    title: 'Settings',\n    icon: Settings,\n    href: '/settings',\n    roles: ['CASHIER', 'MANAGER', 'OWNER'],\n  },\n];\n```\n\n---\n\n## Verification Checklist\n\nAfter each milestone:\n- [ ] All forms validate correctly\n- [ ] API calls succeed with proper auth\n- [ ] Error states display correctly\n- [ ] Loading states show while fetching\n- [ ] Role-based rendering works\n- [ ] Mobile responsive layout\n- [ ] Accessibility \\(keyboard navigation, ARIA labels\\)\n- [ ] Browser compatibility \\(Chrome, Firefox, Safari\\)\n\n---\n\n## Next Steps After Frontend Complete\n\n1. End-to-end testing with backend\n2. Performance profiling \\(Lighthouse\\)\n3. Accessibility audit \\(axe DevTools\\)\n4. User acceptance testing with shop staff\n5. Training materials/user guide\n6. Production deployment\nFRONTEND_PLAN_EOF)"
    ]
  }
}
